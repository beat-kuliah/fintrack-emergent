(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[507],{6971:function(e,t,a){Promise.resolve().then(a.bind(a,2217))},2217:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var c=a(7437),s=a(2265),l=a(5185),n=a(6070),r=a(2869),i=a(5186),o=a(6815),d=a(6110),x=a(3647),h=a(3464),p=a(9397),m=a(2568),u=a(8930);let j="http://localhost:8001/api";function g(){let[e,t]=(0,s.useState)([]),[a,g]=(0,s.useState)([]),[y,f]=(0,s.useState)(!0),[b,N]=(0,s.useState)(!1),[k,v]=(0,s.useState)({account_id:"",name:"",balance:"",percentage_allocation:""}),[_,w]=(0,s.useState)("");(0,s.useEffect)(()=>{C()},[]);let C=async()=>{let e=localStorage.getItem("token");if(e)try{let[a,c]=await Promise.all([h.Z.get("".concat(j,"/pockets"),{headers:{Authorization:"Bearer ".concat(e)}}),h.Z.get("".concat(j,"/accounts"),{headers:{Authorization:"Bearer ".concat(e)}})]);t(a.data||[]),g(c.data||[])}catch(e){console.error("Failed to fetch data",e)}finally{f(!1)}},S=async e=>{e.preventDefault();let t=localStorage.getItem("token");if(!t)return;let a="credit_card"===_&&parseFloat(k.balance)||0;try{await h.Z.post("".concat(j,"/pockets"),{account_id:k.account_id,name:k.name,balance:a,percentage_allocation:parseFloat(k.percentage_allocation)||0},{headers:{Authorization:"Bearer ".concat(t)}}),N(!1),v({account_id:"",name:"",balance:"",percentage_allocation:""}),w(""),C()}catch(e){var c,s;alert((null===(s=e.response)||void 0===s?void 0:null===(c=s.data)||void 0===c?void 0:c.error)||"Failed to create pocket")}},Z=async e=>{if(!confirm("Are you sure you want to delete this pocket?"))return;let t=localStorage.getItem("token");if(t)try{await h.Z.delete("".concat(j,"/pockets/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}}),C()}catch(e){var a,c;alert((null===(c=e.response)||void 0===c?void 0:null===(a=c.data)||void 0===a?void 0:a.error)||"Failed to delete pocket")}},P=e=>{let t=a.find(t=>t.id===e);return(null==t?void 0:t.name)||"Unknown Account"};return y?(0,c.jsx)(l.Z,{children:(0,c.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,c.jsx)("p",{children:"Loading..."})})}):(0,c.jsx)(l.Z,{children:(0,c.jsxs)("div",{className:"space-y-6","data-testid":"pockets-page",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Pockets"}),(0,c.jsx)("p",{className:"text-gray-500 mt-1",children:"Organize your money into different pockets"})]}),(0,c.jsxs)(r.z,{onClick:()=>N(!0),"data-testid":"add-pocket-button",children:[(0,c.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Add Pocket"]})]}),(0,c.jsxs)(n.Zb,{className:"bg-gradient-to-br from-purple-500 to-purple-600 text-white",children:[(0,c.jsxs)(n.Ol,{children:[(0,c.jsx)(n.ll,{className:"text-white",children:"Total in Pockets"}),(0,c.jsxs)(n.SZ,{className:"text-purple-100",children:["Across all ",e.length," pockets"]})]}),(0,c.jsx)(n.aY,{children:(0,c.jsxs)("p",{className:"text-4xl font-bold",children:["Rp ",e.reduce((e,t)=>e+t.balance,0).toLocaleString("id-ID")]})})]}),(0,c.jsxs)(n.Zb,{"data-testid":"pockets-list",children:[(0,c.jsxs)(n.Ol,{children:[(0,c.jsx)(n.ll,{children:"Your Pockets"}),(0,c.jsx)(n.SZ,{children:"Money allocated to different purposes"})]}),(0,c.jsx)(n.aY,{children:0===e.length?(0,c.jsxs)("div",{className:"text-center py-12","data-testid":"no-pockets-message",children:[(0,c.jsx)(m.Z,{className:"h-16 w-16 mx-auto text-gray-400 mb-4"}),(0,c.jsx)("p",{className:"text-gray-500 mb-4",children:"No pockets yet. Create your first pocket to organize your money."}),(0,c.jsxs)(r.z,{onClick:()=>N(!0),children:[(0,c.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Create Pocket"]})]}):(0,c.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>(0,c.jsxs)("div",{className:"p-6 border rounded-lg hover:shadow-md transition-shadow","data-testid":"pocket-item-".concat(e.id),children:[(0,c.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,c.jsx)("div",{className:"p-3 bg-purple-100 rounded-full text-purple-600",children:(0,c.jsx)(m.Z,{className:"h-6 w-6"})}),(0,c.jsx)(r.z,{variant:"ghost",size:"icon",onClick:()=>Z(e.id),"data-testid":"delete-pocket-".concat(e.id),children:(0,c.jsx)(u.Z,{className:"h-4 w-4 text-red-500"})})]}),(0,c.jsx)("h3",{className:"font-semibold text-lg mb-2",children:e.name}),(0,c.jsx)("p",{className:"text-sm text-gray-500 mb-3",children:P(e.account_id)}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Balance:"}),(0,c.jsxs)("span",{className:"font-bold text-lg",children:["Rp ",e.balance.toLocaleString("id-ID")]})]}),e.percentage_allocation>0&&(0,c.jsxs)("div",{className:"flex justify-between items-center",children:[(0,c.jsx)("span",{className:"text-sm text-gray-600",children:"Allocation:"}),(0,c.jsxs)("span",{className:"text-sm font-medium text-purple-600",children:[e.percentage_allocation,"%"]})]})]})]},e.id))})})]}),(0,c.jsx)(d.Vq,{open:b,onOpenChange:N,children:(0,c.jsxs)(d.cZ,{"data-testid":"add-pocket-dialog",children:[(0,c.jsxs)(d.fK,{children:[(0,c.jsx)(d.$N,{children:"Add New Pocket"}),(0,c.jsx)(d.Be,{children:"Create a new pocket to organize your money by purpose"})]}),(0,c.jsxs)("form",{onSubmit:S,children:[(0,c.jsxs)("div",{className:"space-y-4 py-4",children:[(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)(o._,{htmlFor:"account",children:"Parent Account"}),(0,c.jsxs)(x.Ph,{value:k.account_id,onValueChange:e=>{let t=a.find(t=>t.id===e);v({...k,account_id:e,balance:""}),w((null==t?void 0:t.type)||"")},required:!0,children:[(0,c.jsx)(x.i4,{"data-testid":"pocket-account-select",children:(0,c.jsx)(x.ki,{placeholder:"Select account"})}),(0,c.jsx)(x.Bw,{children:a.map(e=>(0,c.jsxs)(x.Ql,{value:e.id,children:[e.name," (",e.type.replace("_"," "),")"]},e.id))})]}),_&&"credit_card"!==_&&(0,c.jsx)("p",{className:"text-xs text-amber-600",children:"⚠️ Balance can only be set for Credit Card accounts"})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)(o._,{htmlFor:"name",children:"Pocket Name"}),(0,c.jsx)(i.I,{id:"name",placeholder:"e.g., Emergency Fund, Vacation",value:k.name,onChange:e=>v({...k,name:e.target.value}),required:!0,"data-testid":"pocket-name-input"})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(o._,{htmlFor:"balance",children:["Initial Balance","credit_card"!==_&&(0,c.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(Only for Credit Card)"})]}),(0,c.jsx)(i.I,{id:"balance",type:"number",step:"0.01",placeholder:"credit_card"===_?"0":"0 (Read only)",value:"credit_card"===_?k.balance:"0",onChange:e=>{"credit_card"===_&&v({...k,balance:e.target.value})},disabled:"credit_card"!==_,className:"credit_card"!==_?"bg-gray-100 cursor-not-allowed":"","data-testid":"pocket-balance-input"}),"credit_card"===_?(0,c.jsx)("p",{className:"text-xs text-gray-500",children:"Set initial balance for this credit card pocket"}):(0,c.jsx)("p",{className:"text-xs text-gray-500",children:"Balance is automatically set to 0 for non-credit accounts"})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsx)(o._,{htmlFor:"percentage",children:"Allocation Percentage"}),(0,c.jsx)(i.I,{id:"percentage",type:"number",step:"0.01",min:"0",max:"100",placeholder:"0",value:k.percentage_allocation,onChange:e=>v({...k,percentage_allocation:e.target.value}),"data-testid":"pocket-percentage-input"}),(0,c.jsx)("p",{className:"text-xs text-gray-500",children:"Percentage of income to automatically allocate to this pocket"})]})]}),(0,c.jsxs)(d.cN,{children:[(0,c.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancel"}),(0,c.jsx)(r.z,{type:"submit","data-testid":"submit-pocket-button",children:"Create Pocket"})]})]})]})})]})})}}},function(e){e.O(0,[809,444,441,358,971,117,744],function(){return e(e.s=6971)}),_N_E=e.O()}]);